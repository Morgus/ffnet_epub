#!/usr/bin/env python

import argparse, threading, sys
import backend

def main():
    parser = argparse.ArgumentParser(
            description="Create Epub documents from fanfiction online.",
            formatter_class=argparse.RawTextHelpFormatter)
    parser.add_argument("-c", "--connections", default=2, type=int,
        help="maximum number of simultaneous connections (default 2)")
    parser.add_argument("-f", "--file",
     help="filename for the resulting Epub\n(default <author> - <title>.epub)")
    parser.add_argument("URL", help="URL of the first chapter")
    parser.add_argument("--version", action="version",
            version="%(prog)s 1.0\n2014 Aleksi Blinnikka")
    args = parser.parse_args()

    print("Downloading story from {}".format(args.URL))
    creator_thread = threading.Thread(target=backend.create_document,
            args=(args.URL, args.connections, args.file))
    creator_thread.start()
    while True:
        print(".", end="")
        sys.stdout.flush()
        creator_thread.join(timeout=3)
        if not creator_thread.is_alive():
            break
    print("\nDownloaded!")

if __name__ == "__main__":
    main()

